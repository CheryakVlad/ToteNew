@model IEnumerable<Common.Models.Match>

@{
    Layout = @"\Views\LayoutView.cshtml"; 
}

    
    
    @section Scripts
{
    <script src="~/scripts/bootstrap.js"></script>
    <script src="~/scripts/jquery-3.2.1.min.js"></script>
    <script src="~/scripts/jquery-ui-1.12.1.min.js"></script>
    <script src="~/scripts/jquery.unobtrusive-ajax.js"></script>
    <script src="~/scripts/Sort/Sorting/addNoneToSportDropDown.js"></script>
    <script src="~/scripts/Sort/Sorting/jsonDate.js"></script>
    <script src="~/scripts/Sort/Sorting/parseJsonDate.js"></script>
    
}

    <br />
    <br />
    <br />
    <h2>
        Sorting
    </h2>

    Select Sport
    @Html.DropDownList("sport", ViewBag.Sports as SelectList)

    
    Select Status
    <select id="status">
        <option value="0">None</option>
        <option value="1">Past Events</option>
        <option value="2">Current Events</option>
        <option value="3">Future Events</option>
    </select>

    Date Match
    <input type="date" id="dateField" value="EnterDate" />

    <input type="button" value="Sort" id="btnSort" />
    

    <table class="table" id="table">
        <thead>
            
            <tr>
                <th>
                    Tournament
                </th>
                <th>
                    Home Team
                </th>
                <th>
                    Guest Team
                </th>
                <th>
                    Date
                </th>
                <th>
                    Score
                </th>
                <th>
                    Coefficient
                </th>
                <th>

                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Tournament.Name)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Teams[0].Name)
                    (@Html.DisplayFor(modelItem => item.Teams[0].Country.Name))
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Teams[1].Name)
                    (@Html.DisplayFor(modelItem => item.Teams[1].Country.Name))
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Date)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Score)
                </td>
                <td>

                    @Html.RouteLink("Show Coefficients", new
               {
                   controller = "Sort",
                   action = "ShowCoefficient",
                   matchId = item.MatchId
               })


                </td>

            </tr>
            }
        </tbody>
            

        

    </table>


<script>
$(function () {
    $("#btnSort").click(function () {
        var sportId = $("#sport").val();
        var dateMatch = $('#dateField').val();
        var date_Match = new Date();
        if (dateMatch == '') {
            dateMatch = '';
        }
        else {
            var parts = dateMatch.split("-");
            dateMatch = parts[2] + '-' + parts[0] + '-' + parts[1];
        }

        var status = $('#status').val();

        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: '/Sort/AjaxMethod?sportId=' + sportId + '&dateMatch=' + dateMatch + '&status=' + status,
            success: function (data) {
                $('#table > tbody').empty();

                $(data).each(function (index, item) {
                    var date = jsonDate(item.Date);
                    $('#table > tbody').append("<tr><td>" + item.Tournament.Name + "</td><td>" + item.Teams[0].Name 
                        + " (" + item.Teams[0].Country.Name + ")</td><td>"
        + item.Teams[1].Name + " (" + item.Teams[1].Country.Name + ")</td><td>" + date + "</td><td>" + item.Score + "</td><td> "
        + " <a href=\"/Sort/ShowCoefficient?matchId=" + item.MatchId + "\">Show Coefficients</a>"+ "</td></tr>");
                    $('#table').addClass('table');
                })
            }
        });
        $('#table').addClass('table');
    })
})

</script>
